<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R client for the calcite demonstrator • calcite</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="R client for the calcite demonstrator">
<meta property="og:description" content="calcite">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">calcite</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.98.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/userguide.html">R client for the calcite demonstrator</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>R client for the calcite demonstrator</h1>
                        <h4 data-toc-skip class="author">Aaron Lun</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:infinite.monkeys.with.keyboards@gmail.com" class="email">infinite.monkeys.with.keyboards@gmail.com</a>
      
                  
            <h4 data-toc-skip class="date">Revised: October 7, 2022</h4>
      
      
      <div class="hidden name"><code>userguide.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><em><a href="https://github.com/ArtifactDB/calcite-R" class="external-link">calcite</a></em>
implements a simple R client for interacting with the
<strong>calcite</strong> demonstrator API. <strong>calcite</strong>
provides an ExperimentHub-like data store for Bioconductor objects based
on the <a href="https://github.com/ArtifactDB/calcite-schemas" class="external-link">schemas
here</a>. Its purpose is to demonstrate how the ArtifactDB framework can
be easily adapted for other applications.</p>
</div>
<div class="section level2">
<h2 id="fetching-objects-from-the-backend">Fetching objects from the backend<a class="anchor" aria-label="anchor" href="#fetching-objects-from-the-backend"></a>
</h2>
<p>The <code><a href="../reference/fetchObject.html">fetchObject()</a></code> function will load an R object from
the <strong>calcite</strong> backend, given the object’s identifier:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">calcite</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/examples.html">exampleID</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "test:my_first_df@v1"</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchObject.html">fetchObject</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="va">obj</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 10 rows and 4 columns</span></span>
<span><span class="co">##            X           Y        Z                  AA</span></span>
<span><span class="co">##    &lt;integer&gt; &lt;character&gt; &lt;factor&gt;         &lt;DataFrame&gt;</span></span>
<span><span class="co">## 1          1           A        a 0.221781: 0.1249998</span></span>
<span><span class="co">## 2          2           B        b 0.331854:-0.9385503</span></span>
<span><span class="co">## 3          3           C        c 0.807343: 1.3094641</span></span>
<span><span class="co">## 4          4           D        d 0.483355:-0.6231195</span></span>
<span><span class="co">## 5          5           E        e 0.108293:-0.0249276</span></span>
<span><span class="co">## 6          6           F        f 0.466883: 0.8491610</span></span>
<span><span class="co">## 7          7           G        g 0.243697:-0.4783389</span></span>
<span><span class="co">## 8          8           H        h 0.848236: 0.4384521</span></span>
<span><span class="co">## 9          9           I        i 0.316582: 0.2180794</span></span>
<span><span class="co">## 10        10           J        j 0.582001: 0.7062769</span></span></code></pre>
<p>We can extract the ExperimentHub-like metadata using
<code><a href="../reference/annotateObject.html">objectAnnotation()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/annotateObject.html">objectAnnotation</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 8</span></span>
<span><span class="co">##  $ title       : chr "FOO"</span></span>
<span><span class="co">##  $ description : chr "I am a data frame"</span></span>
<span><span class="co">##  $ maintainers :List of 1</span></span>
<span><span class="co">##   ..$ :List of 2</span></span>
<span><span class="co">##   .. ..$ name : chr "Aaron Lun"</span></span>
<span><span class="co">##   .. ..$ email: chr "infinite.monkeys.with.keyboards@gmail.com"</span></span>
<span><span class="co">##  $ species     : int 9606</span></span>
<span><span class="co">##  $ genome      :List of 1</span></span>
<span><span class="co">##   ..$ :List of 2</span></span>
<span><span class="co">##   .. ..$ id    : chr "hg38"</span></span>
<span><span class="co">##   .. ..$ source: chr "UCSC"</span></span>
<span><span class="co">##  $ origin      :List of 1</span></span>
<span><span class="co">##   ..$ :List of 2</span></span>
<span><span class="co">##   .. ..$ source: chr "PubMed"</span></span>
<span><span class="co">##   .. ..$ id    : chr "123456789"</span></span>
<span><span class="co">##  $ bioc_version: chr "3.16"</span></span>
<span><span class="co">##  $ _extra      :List of 9</span></span>
<span><span class="co">##   ..$ $schema      : chr "csv_data_frame/v1.json"</span></span>
<span><span class="co">##   ..$ id           : chr "test:my_first_df/simple.csv.gz@v1"</span></span>
<span><span class="co">##   ..$ project_id   : chr "test"</span></span>
<span><span class="co">##   ..$ version      : chr "v1"</span></span>
<span><span class="co">##   ..$ metapath     : chr "my_first_df/simple.csv.gz"</span></span>
<span><span class="co">##   ..$ meta_indexed : chr "2022-10-07T20:26:32.770Z"</span></span>
<span><span class="co">##   ..$ meta_uploaded: chr "2022-10-07T20:26:09.376Z"</span></span>
<span><span class="co">##   ..$ uploaded     : chr "2022-10-07T20:26:09.376Z"</span></span>
<span><span class="co">##   ..$ permissions  :List of 5</span></span>
<span><span class="co">##   .. ..$ scope       : chr "project"</span></span>
<span><span class="co">##   .. ..$ read_access : chr "public"</span></span>
<span><span class="co">##   .. ..$ write_access: chr "owners"</span></span>
<span><span class="co">##   .. ..$ owners      : chr "ArtifactDB-bot"</span></span>
<span><span class="co">##   .. ..$ viewers     : list()</span></span></code></pre>
<p>More complex objects can be loaded if the corresponding <a href="https://github.com/ArtifactDB/alabaster.base" class="external-link"><strong>alabaster</strong></a>
packages are installed. For example, we can load <a href="https://bioconductor.org/packages/SingleCellExperiment" class="external-link"><code>SingleCellExperiment</code></a>
objects if <em><a href="https://github.com/ArtifactDB/alabaster.sce" class="external-link">alabaster.sce</a></em>
is installed.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fetchObject.html">fetchObject</a></span><span class="op">(</span><span class="st">"test:my_first_sce@v1"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## class: SingleCellExperiment</span></span>
<span><span class="co">## dim: 20006 3005</span></span>
<span><span class="co">## metadata(1): .internal</span></span>
<span><span class="co">## assays(1): counts</span></span>
<span><span class="co">## rownames(20006): Tspan12 Tshz1 ... mt-Rnr1 mt-Nd4l</span></span>
<span><span class="co">## rowData names(1): featureType</span></span>
<span><span class="co">## colnames(3005): 1772071015_C02 1772071017_G12 ... 1772066098_A12</span></span>
<span><span class="co">##   1772058148_F03</span></span>
<span><span class="co">## colData names(10): tissue group # ... level1class level2class</span></span>
<span><span class="co">## reducedDimNames(0):</span></span>
<span><span class="co">## mainExpName: endogenous</span></span>
<span><span class="co">## altExpNames(2): ERCC repeat</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="saving-objects-to-the-backend">Saving objects to the backend<a class="anchor" aria-label="anchor" href="#saving-objects-to-the-backend"></a>
</h2>
<p>Given some Bioconductor objects, we can annotate them with
ExperimentHub-like metadata:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/S4Vectors" class="external-link">S4Vectors</a></span><span class="op">)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>A<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, B<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, row.names<span class="op">=</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotateObject.html">annotateObject</a></span><span class="op">(</span><span class="va">df1</span>, </span>
<span>    title<span class="op">=</span><span class="st">"FOO"</span>,</span>
<span>    description<span class="op">=</span><span class="st">"Ich bien ein data frame"</span>,</span>
<span>    maintainers<span class="op">=</span><span class="st">"Aaron Lun &lt;infinite.monkeys.with.keyboards@gmail.com&gt;"</span>,</span>
<span>    species<span class="op">=</span><span class="fl">9606</span>,</span>
<span>    genome<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>id<span class="op">=</span><span class="st">"hg38"</span>, source<span class="op">=</span><span class="st">"UCSC"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    origin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>source<span class="op">=</span><span class="st">"PubMed"</span>, id<span class="op">=</span><span class="st">"123456789"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then we save them into a “staging directory”:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">staging</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">staging</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/saveObject.html">saveObject</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">staging</span>, <span class="st">"df001"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">staging</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "df001.json"               "df001/simple.csv.gz"     </span></span>
<span><span class="co">## [3] "df001/simple.csv.gz.json"</span></span></code></pre>
<p>Any name can be used for the objects, and multiple objects can be
saved into the same directory. Objects can even be saved into
subdirectories:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>A<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, B<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, row.names<span class="op">=</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotateObject.html">annotateObject</a></span><span class="op">(</span><span class="va">df1</span>, </span>
<span>    title<span class="op">=</span><span class="st">"BAR"</span>,</span>
<span>    description<span class="op">=</span><span class="st">"Je suis une data frame"</span>,</span>
<span>    maintainers<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Darth Vader"</span>, email<span class="op">=</span><span class="st">"vader@empire.gov"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    species<span class="op">=</span><span class="fl">10090</span>,</span>
<span>    genome<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>id<span class="op">=</span><span class="st">"GRCm38"</span>, source<span class="op">=</span><span class="st">"Ensembl"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    origin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>source<span class="op">=</span><span class="st">"GEO"</span>, id<span class="op">=</span><span class="st">"GSE123456"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">staging</span>, <span class="st">"variants"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/saveObject.html">saveObject</a></span><span class="op">(</span><span class="va">df2</span>, <span class="va">staging</span>, <span class="st">"variants/df002"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">staging</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "df001.json"                        "df001/simple.csv.gz"              </span></span>
<span><span class="co">## [3] "df001/simple.csv.gz.json"          "variants/df002.json"              </span></span>
<span><span class="co">## [5] "variants/df002/simple.csv.gz"      "variants/df002/simple.csv.gz.json"</span></span></code></pre>
<p>Once we’re done with staging, we’re ready to upload. We pick a
project name and version and call the <code><a href="../reference/uploadDirectory.html">uploadDirectory()</a></code>
function. This will prompt us for a <a href="https://github.com/settings/tokens" class="external-link">GitHub personal access
token</a> to authenticate into the backend, if we haven’t supplied one
already.</p>
<p>🚨🚨🚨 <strong>ALERT!</strong> For cost and security reasons, the
demonstrator instance only allows a certain set of GitHub users to
perform new uploads. If you’re not on the <a href="https://github.com/ArtifactDB/calcite-worker/master/tree/wrangler.toml" class="external-link">list</a>,
you’ll have to ask someone to create a stub project for you before you
can use <code><a href="../reference/uploadDirectory.html">uploadDirectory()</a></code>. 🚨🚨🚨</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setting an expiry date of 1 day in the future, to avoid having lots of</span></span>
<span><span class="co"># testing projects lying around in the data store.</span></span>
<span><span class="fu"><a href="../reference/uploadDirectory.html">uploadDirectory</a></span><span class="op">(</span><span class="va">staging</span>, </span>
<span>    project<span class="op">=</span><span class="st">"test-vignette"</span>, </span>
<span>    version<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="co"># using the date as the version.</span></span>
<span>    expires<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="delayedarray-wrappers-for-calcite">
<code>DelayedArray</code> wrappers for calcite<a class="anchor" aria-label="anchor" href="#delayedarray-wrappers-for-calcite"></a>
</h2>
<p>For arrays, <em><a href="https://github.com/ArtifactDB/calcite-R" class="external-link">calcite</a></em> offers
some special behavior during loading:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchObject.html">fetchObject</a></span><span class="op">(</span><span class="st">"test:my_first_sce/assay-1/matrix.h5@v1"</span><span class="op">)</span></span>
<span><span class="va">mat</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;20006 x 3005&gt; sparse matrix of class CalciteMatrix and type "integer":</span></span>
<span><span class="co">##          1772071015_C02 1772071017_G12 ... 1772066098_A12 1772058148_F03</span></span>
<span><span class="co">##  Tspan12              0              0   .              0              1</span></span>
<span><span class="co">##    Tshz1              3              1   .              0              1</span></span>
<span><span class="co">##   Fnbp1l              3              1   .              0              0</span></span>
<span><span class="co">## Adamts15              0              0   .              0              0</span></span>
<span><span class="co">##   Cldn12              1              1   .              0              0</span></span>
<span><span class="co">##      ...              .              .   .              .              .</span></span>
<span><span class="co">##   mt-Co2             65             97   .             29            120</span></span>
<span><span class="co">##   mt-Co1             75            111   .             20            143</span></span>
<span><span class="co">##  mt-Rnr2            158            326   .             36            359</span></span>
<span><span class="co">##  mt-Rnr1             31             88   .             12             52</span></span>
<span><span class="co">##  mt-Nd4l             13             14   .              3             13</span></span></code></pre>
<p>The <code>CalciteArray</code> object is a <a href="https://bioconductor.org/packages/DelayedArray" class="external-link"><code>DelayedArray</code></a>
subclass that remembers its ArtifactDB identifier. This provides some
optimization opportunities during the save/upload of the unmodified
array. For example, let’s wrap <code>mat</code> inside an annotated list
and save it:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/List-class.html" class="external-link">List</a></span><span class="op">(</span>thingy<span class="op">=</span><span class="va">mat</span><span class="op">)</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotateObject.html">annotateObject</a></span><span class="op">(</span><span class="va">obj</span>,</span>
<span>    title<span class="op">=</span><span class="st">"FOO"</span>,</span>
<span>    description<span class="op">=</span><span class="st">"I am a list"</span>,</span>
<span>    maintainers<span class="op">=</span><span class="st">"Aaron Lun &lt;infinite.monkeys.with.keyboards@gmail.com&gt;"</span>,</span>
<span>    species<span class="op">=</span><span class="fl">9606</span>,</span>
<span>    genome<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>id<span class="op">=</span><span class="st">"hg38"</span>, source<span class="op">=</span><span class="st">"UCSC"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    origin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>source<span class="op">=</span><span class="st">"PubMed"</span>, id<span class="op">=</span><span class="st">"123456789"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/saveObject.html">saveObject</a></span><span class="op">(</span><span class="va">obj</span>, <span class="va">dir</span>, <span class="st">"bar"</span><span class="op">)</span></span></code></pre></div>
<p>If we were inclined to dig around in the <code>bar</code> directory,
we would see that the <code>array</code> data in <code>child-1</code>
doesn’t actually contain any data, but just a link to the existing
ArtifactDB identifier. This instructs <code><a href="../reference/uploadDirectory.html">uploadDirectory()</a></code> to
also skip the upload and create a link on the backend.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">zircon</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zircon/man/createPlaceholderLink.html" class="external-link">extractLinkedID</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"bar/child-1/array"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "test:my_first_sce/assay-1/matrix.h5@v1"</span></span></code></pre>
<p>In this manner, we can save compute time, upload bandwidth and
storage space when creating new versions of an object. The biggest
beneficiary of this functionality is the
<code>SummarizedExperiment</code>, where we can update metadata,
row/column annotations, etc. at low cost provided that the underlying
assay data does not change.</p>
<p>By default, the <code>CalciteArray</code> is created with file-backed
arrays from the <em><a href="https://bioconductor.org/packages/3.16/HDF5Array" class="external-link">HDF5Array</a></em>
package. This ensures that it can be easily manipulated in an R session
with a small memory footprint. However, for analysis steps that actually
use the array contents, it is best to convert the
<code>CalciteArray</code> into an in-memory representation to avoid
repeated disk queries:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">mat</span>, <span class="st">"dgCMatrix"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">smat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'dgCMatrix' [package "Matrix"] with 6 slots</span></span>
<span><span class="co">##   ..@ i       : int [1:11349080] 1 2 4 7 8 12 14 17 19 20 ...</span></span>
<span><span class="co">##   ..@ p       : int [1:3006] 0 4871 9583 15638 21490 26214 31641 37918 43681 48970 ...</span></span>
<span><span class="co">##   ..@ Dim     : int [1:2] 20006 3005</span></span>
<span><span class="co">##   ..@ Dimnames:List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:20006] "Tspan12" "Tshz1" "Fnbp1l" "Adamts15" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:3005] "1772071015_C02" "1772071017_G12" "1772071017_A05" "1772071014_B06" ...</span></span>
<span><span class="co">##   ..@ x       : num [1:11349080] 3 3 1 11 1 1 3 9 5 13 ...</span></span>
<span><span class="co">##   ..@ factors : list()</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="searching-for-objects">Searching for objects<a class="anchor" aria-label="anchor" href="#searching-for-objects"></a>
</h2>
<p>🚧🚧🚧 <strong>Coming soon</strong> 🚧🚧🚧</p>
</div>
<div class="section level2">
<h2 id="advanced-usage">Advanced usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a>
</h2>
<p>The <strong>calcite</strong> API is just another ArtifactDB instance,
so all methods in the <em><a href="https://github.com/ArtifactDB/zircon-R" class="external-link">zircon-R</a></em> package
can be used. For example, we can directly fetch the metadata for
individual components:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">zircon</span><span class="op">)</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zircon/man/getFileMetadata.html" class="external-link">getFileMetadata</a></span><span class="op">(</span><span class="fu"><a href="../reference/examples.html">exampleID</a></span><span class="op">(</span><span class="op">)</span>, url<span class="op">=</span><span class="fu"><a href="../reference/restURL.html">restURL</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">meta</span><span class="op">$</span><span class="va">data_frame</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 3</span></span>
<span><span class="co">##  $ columns   :List of 4</span></span>
<span><span class="co">##   ..$ :List of 2</span></span>
<span><span class="co">##   .. ..$ name: chr "X"</span></span>
<span><span class="co">##   .. ..$ type: chr "integer"</span></span>
<span><span class="co">##   ..$ :List of 2</span></span>
<span><span class="co">##   .. ..$ name: chr "Y"</span></span>
<span><span class="co">##   .. ..$ type: chr "string"</span></span>
<span><span class="co">##   ..$ :List of 3</span></span>
<span><span class="co">##   .. ..$ name  : chr "Z"</span></span>
<span><span class="co">##   .. ..$ type  : chr "factor"</span></span>
<span><span class="co">##   .. ..$ levels:List of 1</span></span>
<span><span class="co">##   .. .. ..$ resource:List of 2</span></span>
<span><span class="co">##   .. .. .. ..$ type: chr "local"</span></span>
<span><span class="co">##   .. .. .. ..$ path: chr "my_first_df/column3/levels.csv.gz"</span></span>
<span><span class="co">##   ..$ :List of 3</span></span>
<span><span class="co">##   .. ..$ name    : chr "AA"</span></span>
<span><span class="co">##   .. ..$ type    : chr "other"</span></span>
<span><span class="co">##   .. ..$ resource:List of 2</span></span>
<span><span class="co">##   .. .. ..$ type: chr "local"</span></span>
<span><span class="co">##   .. .. ..$ path: chr "my_first_df/column4/simple.csv.gz"</span></span>
<span><span class="co">##  $ row_names : logi FALSE</span></span>
<span><span class="co">##  $ dimensions: int [1:2] 10 4</span></span></code></pre>
<p>We can inspect the permissions for a project:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/zircon/man/getPermissions.html" class="external-link">getPermissions</a></span><span class="op">(</span><span class="st">"test"</span>, url<span class="op">=</span><span class="fu"><a href="../reference/restURL.html">restURL</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $scope</span></span>
<span><span class="co">## [1] "project"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $read_access</span></span>
<span><span class="co">## [1] "public"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $write_access</span></span>
<span><span class="co">## [1] "owners"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $owners</span></span>
<span><span class="co">## [1] "ArtifactDB-bot"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $viewers</span></span>
<span><span class="co">## character(0)</span></span></code></pre>
<p>And we can pull down all metadata for a particular version of a
project:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v1.meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zircon/man/getProjectMetadata.html" class="external-link">getProjectMetadata</a></span><span class="op">(</span><span class="st">"test"</span>, version<span class="op">=</span><span class="st">"v1"</span>, url<span class="op">=</span><span class="fu"><a href="../reference/restURL.html">restURL</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">v1.meta</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 17</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.2.1 (2022-06-23)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 20.04.5 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3</span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] zircon_0.98.0       S4Vectors_0.35.4    BiocGenerics_0.43.4</span></span>
<span><span class="co">## [4] calcite_0.98.0      BiocStyle_2.25.0   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] Rcpp_1.0.9               lattice_0.20-45          V8_4.2.1                </span></span>
<span><span class="co">##  [4] assertthat_0.2.1         rprojroot_2.0.3          digest_0.6.29           </span></span>
<span><span class="co">##  [7] utf8_1.2.2               BiocFileCache_2.5.2      R6_2.5.1                </span></span>
<span><span class="co">## [10] alabaster.schemas_0.98.0 calcite.schemas_0.98.1   alabaster.matrix_0.98.0 </span></span>
<span><span class="co">## [13] RSQLite_2.2.18           evaluate_0.16            httr_1.4.4              </span></span>
<span><span class="co">## [16] pillar_1.8.1             rlang_1.0.6              curl_4.3.3              </span></span>
<span><span class="co">## [19] jquerylib_0.1.4          blob_1.2.3               Matrix_1.5-1            </span></span>
<span><span class="co">## [22] rmarkdown_2.17           pkgdown_2.0.6            textshaping_0.3.6       </span></span>
<span><span class="co">## [25] desc_1.4.2               stringr_1.4.1            bit_4.0.4               </span></span>
<span><span class="co">## [28] HDF5Array_1.25.2         DelayedArray_0.23.2      compiler_4.2.1          </span></span>
<span><span class="co">## [31] xfun_0.33                pkgconfig_2.0.3          systemfonts_1.0.4       </span></span>
<span><span class="co">## [34] htmltools_0.5.3          tidyselect_1.1.2         tibble_3.1.8            </span></span>
<span><span class="co">## [37] bookdown_0.29            IRanges_2.31.2           matrixStats_0.62.0      </span></span>
<span><span class="co">## [40] jsonvalidate_1.3.2       fansi_1.0.3              alabaster.base_0.98.0   </span></span>
<span><span class="co">## [43] dplyr_1.0.10             dbplyr_2.2.1             rhdf5filters_1.9.0      </span></span>
<span><span class="co">## [46] rappdirs_0.3.3           grid_4.2.1               jsonlite_1.8.2          </span></span>
<span><span class="co">## [49] lifecycle_1.0.2          DBI_1.1.3                magrittr_2.0.3          </span></span>
<span><span class="co">## [52] cli_3.4.1                stringi_1.7.8            cachem_1.0.6            </span></span>
<span><span class="co">## [55] fs_1.5.2                 bslib_0.4.0              ellipsis_0.3.2          </span></span>
<span><span class="co">## [58] filelock_1.0.2           ragg_1.2.3               generics_0.1.3          </span></span>
<span><span class="co">## [61] vctrs_0.4.2              Rhdf5lib_1.19.2          tools_4.2.1             </span></span>
<span><span class="co">## [64] bit64_4.0.5              glue_1.6.2               purrr_0.3.5             </span></span>
<span><span class="co">## [67] MatrixGenerics_1.9.1     fastmap_1.1.0            yaml_2.3.5              </span></span>
<span><span class="co">## [70] rhdf5_2.41.1             BiocManager_1.30.18      memoise_2.0.1           </span></span>
<span><span class="co">## [73] knitr_1.40               sass_0.4.2</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Aaron Lun.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
